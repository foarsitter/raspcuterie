<!DOCTYPE html>
<html lang="en" class="has-background-danger">
<head>
    <meta charset="UTF-8">
    <title>Raspcuterie</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma-switch@2.0.0/dist/css/bulma-switch.min.css"
          integrity="sha256-jCV/cXwP13w0GNHLgFx6SFgTNAvJPvS5MIhuE30Ng08=" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body class="has-background-danger">

<div id="app">
    <section class="section">
        <div class="container">
            <h1 class="title">
                Raspcuterie
            </h1>
            <p class="subtitle">
                Let it <strong>dry</strong>!
            </p>
            <div class="tile is-ancestor">
                <div class="tile is-8 is-parent ">
                    <div class="tile is-child notification is-white">
                        <div id="humidity">
                            <apexchart type="line" height="230" ref="humidity" :options="humidityChartOptions"
                                       :series="humiditySeries"></apexchart>
                        </div>
                        <div id="temperature">
                            <apexchart type="line" height="230" ref="temperature" :options="temperatureChartOptions"
                                       :series="temperatureSeries"></apexchart>
                        </div>
                    </div>
                </div>
                <div class="tile is-vertical">
                    <div class="tile">
                        <div class="tile is-parent is-vertical">
                            <article class="tile is-child notification is-primary">

                                <apexchart type="radialBar" :options="currentTemperatureOptions"
                                           :series="currentTemperature"></apexchart>

                                <p class="title">Temperature</p>
                                <div class="field">
                                    <input id="switchExample1" type="checkbox" name="switchExample1"
                                           class="switch is-danger"
                                           checked="checked" v-model="refrigerator">
                                    <label for="switchExample1">Koelkast</label>
                                </div>
                                <div class="field">
                                    <input id="switchExample2" type="checkbox" name="switchExample2"
                                           class="switch is-danger"
                                           checked="checked" v-model="heater">
                                    <label for="switchExample2">Verwarming</label>
                                </div>
                            </article>
                            <article class="tile is-child notification is-warning">
                                <apexchart type="radialBar" :options="currentTemperatureOptions"
                                           :series="currentHumidity"></apexchart>
                                <p class="title">Humidity</p>
                                <div class="field">
                                    <input id="switchExample3" type="checkbox" name="switchExample3"
                                           class="switch is-info"
                                           checked="checked" v-model="dehumidifier">
                                    <label for="switchExample3">Ontvochtiger</label>
                                </div>
                                <div class="field">
                                    <input id="switchExample4" type="checkbox" name="switchExample4"
                                           class="switch is-info"
                                           checked="checked" v-model="humidifier">
                                    <label for="switchExample4">Bevochtiger</label>
                                </div>

                            </article>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </section>


</div>


<script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"
        integrity="sha256-FZ8KwMj1F6qnNgA7bhPryVm19xKduH5OVr8u7I1tAtc=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts@3.22.0/dist/apexcharts.js"
        integrity="sha256-4Lasz800h6YPi4MMNryQ1EUqRsW+PBE8g2pus4sK5Nw=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/vue-apexcharts@1.6.0/dist/vue-apexcharts.js"
        integrity="sha256-uFIs+Z5USR6iT5utTt+Hx6Du05iEURM/uwwfVsUUvxc=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/axios@0.20.0/dist/axios.js"
        integrity="sha256-n7FNwoYsyZMMiu5/NHArDRUq4JFdaZNPz8mE+OMC5VM=" crossorigin="anonymous"></script>
<script>

    function graph(name, _min, _max) {

        return {
            chart: {
                id: name,
                type: 'line',
                group: 'social',
                height: 230,
            },
            title: {
                text: name,
                align: 'left'
            },
            stroke: {
                curve: ['smooth', 'stepline', 'stepline'],
                width: 1,
            },
            tooltip: {
                x: {
                    show: true,
                    format: 'HH:mm',
                },
            },
            xaxis: {
                type: 'datetime',
                labels: {
                    datetimeFormatter: {
                        year: 'yyyy',
                        month: 'MMM \'yy',
                        day: 'dd MMM',
                        hour: 'HH:mm'
                    }
                }
            },
            yaxis: [
                {
                    tickAmount: 2,
                    labels: {
                        minWidth: 40
                    },
                    seriesName: "Temperature",
                    min: _min,
                    max: _max,
                },
                {
                    opposite: true,
                    seriesName: "Relay",
                    min: 0,
                    max: 3,
                    show: false,
                },
                {
                    seriesName: "Relay",
                    opposite: true,
                    show: false,
                    min: 0,
                    max: 3,
                }
            ]
        }
    }


    Vue.component('apexchart', VueApexCharts)

    var app = new Vue({
        el: '#app',
        components: {
            apexchart: VueApexCharts,
        },


        data: {
            refrigerator: {% if relay_1 %}true{% else %}false{% endif %},
            dehumidifier: {% if relay_2 %}true{% else %}false{% endif %},
            humidifier: {% if relay_3 %}true{% else %}false{% endif %},
            heater: {% if relay_4 %}true{% else %}false{% endif %},
            humiditySeries: [{
                "data": {{ humidity_data|tojson }},
                "name": "Humidity"
            },
                {
                    "data": {{ dehumidifier_data|tojson }},
                    "name": "Dehumidifier"
                },
                {
                    "data": {{ humidity_data|tojson }},
                    "name": "Humidifier"
                }],
            temperatureSeries: [
                {
                    "data": {{ temperature_data|tojson }},
                    "name": "Temperature"
                },
                {
                    "data": {{ refrigerator_data|tojson }},
                    "name": "Refrigerator"
                },
                {
                    "data": {{ heater_data|tojson }},
                    "name": "Heater"
                }
            ],
            currentTemperature: [{{ temperature }}],
            currentHumidity: [{{ humidity }}],
            currentTemperatureOptions: {
                chart: {
                    type: 'radialBar',
                    offsetY: -20,
                    sparkline: {
                        enabled: true
                    }
                },
                plotOptions: {
                    radialBar: {
                        startAngle: -90,
                        endAngle: 90,
                        track: {
                            background: "#e7e7e7",
                            strokeWidth: '97%',
                            margin: 5, // margin is in pixels
                            dropShadow: {
                                enabled: true,
                                top: 2,
                                left: 0,
                                color: '#999',
                                opacity: 1,
                                blur: 2
                            }
                        },
                        dataLabels: {
                            name: {
                                show: false
                            },
                            value: {
                                offsetY: -2,
                                fontSize: '22px'
                            }
                        }
                    }
                },
                grid: {
                    padding: {
                        top: -10
                    }
                },
                fill: {
                    type: 'gradient',
                    gradient: {
                        shade: 'light',
                        shadeIntensity: 0.4,
                        inverseColors: false,
                        opacityFrom: 1,
                        opacityTo: 1,
                        stops: [0, 50, 53, 91]
                    },
                },
                labels: ['Average Results'],
            },

            humidityChartOptions: graph("Humidity", {{ humidity_min }}, {{humidity_max}}),
            temperatureChartOptions: graph("Temperature", {{ temperature_min }}, {{ temperature_max }}),
        },
        watch: {
            refrigerator: function (val) {
                console.log("refrigerator")
                axios({
                    method: 'GET',
                    url: "/api/relay/relay1/toggle",
                }).then(function (response) {

                })
            },
            humidifier: function (val) {

                console.log("humidifier")
                axios({
                    method: 'GET',
                    url: "/api/relay/relay3/toggle",
                }).then(function (response) {

                })
            },
            dehumidifier: function (val) {

                console.log("dehumidifier")
                axios({
                    method: 'GET',
                    url: "/api/relay/relay2/toggle",
                })
            },
            heater: function (val) {

                console.log("heater")
                axios({
                    method: 'GET',
                    url: "/api/relay/relay4/toggle",
                })
            }
        },
        {# beforeCreate: function () {
                axios({
                    method: 'GET',
                    url: "/api/relay/current.json",
                }).then(function (response) {

                    app.refrigerator = response.data["relay_1"]
                    app.dehumidifier = response.data["relay_2"]
                    app.humidifier = response.data["relay_3"]
                    app.heater = response.data["relay_4"]
                    app.is_loaded = true

                })
            }, #}
    {# mounted: function () {

             axios({
                method: 'GET',
                url: "/api/am2302/chart.json",
            }).then(function (response) {
                app.$refs.humidity.updateSeries([{name: "Humidity", data: response.data[1]["data"]}])
                app.$refs.temperature.updateSeries([{name: "Temperature", data: response.data[0]["data"]}])
            });
        },#}

    });


</script>
<script defer src="https://use.fontawesome.com/releases/v5.14.0/js/all.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bulma-extensions@6.2.7/dist/js/bulma-extensions.min.js"
        integrity="sha256-q4zsxO0fpPm6VhtL/9QkCFE5ZkNa0yeUxhmt1VO1ev0=" crossorigin="anonymous"></script>
</body>
</html>